# How to Get userId from Firebase Auth

## Quick Answer

The userId (also called `uid`) is automatically generated by Firebase Auth when a user signs up. You can access it from the `User` object.

## Methods to Get userId

### 1. **From Current User (Most Common)**

```dart
import 'package:firebase_auth/firebase_auth.dart';

// Get current user's ID
String? userId = FirebaseAuth.instance.currentUser?.uid;

// With null check
if (FirebaseAuth.instance.currentUser != null) {
  String userId = FirebaseAuth.instance.currentUser!.uid;
  print('User ID: $userId');
}
```

### 2. **Using Your AuthService**

Your app already has an `AuthService` with a helper:

```dart
import 'package:circle_app/core/services/auth_service.dart';

// Get current user
User? user = AuthService.instance.currentUser;
String? userId = user?.uid;

// Or directly
String? userId = AuthService.instance.currentUser?.uid;
```

### 3. **After Sign Up**

When a user signs up, the userId is available immediately:

```dart
// In your auth_service.dart (already implemented)
Future<UserCredential?> signUpWithEmailAndPassword({
  required String email,
  required String password,
  required String name,
}) async {
  final credential = await _auth.createUserWithEmailAndPassword(
    email: email,
    password: password,
  );
  
  // Get userId here
  String userId = credential.user!.uid;
  
  // Create user document with this userId
  await _createUserDocument(credential.user!, name);
  
  return credential;
}
```

### 4. **After Sign In**

```dart
// In your auth_service.dart
Future<UserCredential?> signInWithEmailAndPassword({
  required String email,
  required String password,
}) async {
  final credential = await _auth.signInWithEmailAndPassword(
    email: email,
    password: password,
  );
  
  // Get userId here
  String userId = credential.user!.uid;
  
  return credential;
}
```

### 5. **From Auth State Stream**

Listen to authentication state changes:

```dart
import 'package:firebase_auth/firebase_auth.dart';

// Listen to auth state
FirebaseAuth.instance.authStateChanges().listen((User? user) {
  if (user != null) {
    String userId = user.uid;
    print('User is signed in with ID: $userId');
  } else {
    print('User is signed out');
  }
});

// Or using your AuthService
AuthService.instance.authStateChanges.listen((User? user) {
  if (user != null) {
    String userId = user.uid;
  }
});
```

## Practical Examples

### Example 1: Creating a Post

```dart
import 'package:firebase_auth/firebase_auth.dart';
import 'package:cloud_firestore/cloud_firestore.dart';

Future<void> createPost(String circleId, String content) async {
  // Get current user's ID
  String? userId = FirebaseAuth.instance.currentUser?.uid;
  
  if (userId == null) {
    throw Exception('User not authenticated');
  }
  
  // Create post with userId
  await FirebaseFirestore.instance
      .collection('circles')
      .doc(circleId)
      .collection('posts')
      .add({
    'authorId': userId,  // ← This is the userId
    'circleId': circleId,
    'content': content,
    'createdAt': FieldValue.serverTimestamp(),
    'likesCount': 0,
    'commentsCount': 0,
  });
}
```

### Example 2: Getting User Profile

```dart
import 'package:firebase_auth/firebase_auth.dart';
import 'package:cloud_firestore/cloud_firestore.dart';

Future<Map<String, dynamic>?> getUserProfile() async {
  // Get current user's ID
  String? userId = FirebaseAuth.instance.currentUser?.uid;
  
  if (userId == null) return null;
  
  // Fetch user document using userId
  DocumentSnapshot doc = await FirebaseFirestore.instance
      .collection('users')
      .doc(userId)  // ← Use userId as document ID
      .get();
  
  return doc.data() as Map<String, dynamic>?;
}
```

### Example 3: In a Widget

```dart
import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';

class ProfileScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // Get current user
    User? user = FirebaseAuth.instance.currentUser;
    
    if (user == null) {
      return Center(child: Text('Not logged in'));
    }
    
    // Access userId
    String userId = user.uid;
    String? email = user.email;
    String? displayName = user.displayName;
    
    return Scaffold(
      appBar: AppBar(title: Text('Profile')),
      body: Column(
        children: [
          Text('User ID: $userId'),
          Text('Email: $email'),
          Text('Name: $displayName'),
        ],
      ),
    );
  }
}
```

### Example 4: Using StreamBuilder

```dart
import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:cloud_firestore/cloud_firestore.dart';

class UserDataWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return StreamBuilder<User?>(
      stream: FirebaseAuth.instance.authStateChanges(),
      builder: (context, snapshot) {
        if (!snapshot.hasData) {
          return Text('Not logged in');
        }
        
        // Get userId from stream
        String userId = snapshot.data!.uid;
        
        // Use userId to fetch user data
        return StreamBuilder<DocumentSnapshot>(
          stream: FirebaseFirestore.instance
              .collection('users')
              .doc(userId)
              .snapshots(),
          builder: (context, userSnapshot) {
            if (!userSnapshot.hasData) {
              return CircularProgressIndicator();
            }
            
            var userData = userSnapshot.data!.data() as Map<String, dynamic>;
            return Text('Hello, ${userData['name']}!');
          },
        );
      },
    );
  }
}
```

## Important Notes

1. **userId is automatically generated** by Firebase Auth when a user signs up
2. **userId is unique** for each user across your entire Firebase project
3. **userId never changes** for a user (even if they change email/password)
4. **userId is available immediately** after successful sign up or sign in
5. **Use userId as the document ID** in your `users` collection (already done in your app)

## Your App's Implementation

Your app already handles this correctly in `auth_service.dart`:

```dart
// When user signs up
Future<UserCredential?> signUpWithEmailAndPassword({
  required String email,
  required String password,
  required String name,
}) async {
  final credential = await _auth.createUserWithEmailAndPassword(
    email: email,
    password: password,
  );
  
  // userId is available here
  if (credential.user != null) {
    await _createUserDocument(credential.user!, name);
  }
  
  return credential;
}

// Creating user document with userId
Future<void> _createUserDocument(User user, String name) async {
  await _firestore.collection('users').doc(user.uid).set({
    'uid': user.uid,  // ← This is the userId
    'name': name,
    'email': user.email,
    // ... other fields
  });
}
```

## Testing

To see your userId:

1. Run your app: `flutter run`
2. Sign up with a new account
3. Check Firebase Console → Authentication → Users
4. You'll see the User UID column - that's the userId!

Or add this debug code:

```dart
// In your main.dart or any screen
print('Current User ID: ${FirebaseAuth.instance.currentUser?.uid}');
```
